<html>
  <head>
    <title>chartjs-scale-timestack demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="chartjs-scale-timestack.min.js"></script>
  </head>
  <body>
    <div>
      <p>This demo uses the chartjs-zoom-plugin for interactivity</p>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 16px">
        <div style="position: relative">
          <canvas id="chart1"></canvas>
        </div>
        <div style="position: relative">
          <canvas id="chart2"></canvas>
        </div>
        <div style="position: relative">
          <canvas id="chart3"></canvas>
        </div>
        <div style="position: relative">
          <canvas id="chart4"></canvas>
        </div>
        <div style="position: relative">
          <canvas id="chart5"></canvas>
        </div>
        <div style="position: relative">
          <canvas id="chart6"></canvas>
        </div>
      </div>

      <button id="zoomout1" type="button">Zoom Out 1</button>
      <button id="zoomout2" type="button">Zoom Out 2</button>
      <button id="zoomout3" type="button">Zoom Out 3</button>
      <button id="zoomout4" type="button">Zoom Out 4</button>
      <button id="zoomout5" type="button">Zoom Out 5</button>
      <button id="zoomout6" type="button">Zoom Out 6</button>

      <p>
        Zoom with mouse selection, pan with mouse+Ctrl, resize browser window. See the ticks generated at different zoom
        levels and chart widths.
      </p>
    </div>

    <script>
      const max = luxon.DateTime.local();
      const min = max.minus({ month: 2 });
      const from = min.toMillis();
      const to = max.toMillis();
      const range = to - from;

      const points = [];
      let y = 50;
      let min_y = +Infinity;
      let max_y = -Infinity;
      for (let ts = from - range; ts < to + range; ts += range * 3 / 4096) {
        y += Math.random() > 0.5 ? 1 : -1;
        min_y = Math.min(min_y, y);
        max_y = Math.max(max_y, y);
        points.push({ x: ts, y });
      }

      function make_chart(chart_elt, zoom_elt) {
        const ctx = document.getElementById(chart_elt);

        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            datasets: [
              {
                data: points,
                borderWidth: 1,
                pointRadius: 0,
              },
            ],
          },
          options: {
            maintainAspectRatio: false,
            animation: false,
            scales: {
              x: {
                type: 'timestack',
                ticks: {
                  color: (ctx) => (ctx?.tick?.major ? '#222' : '#666'),
                },
                min: from,
                max: to,
              },
              y: {
                type: 'linear',
                min: min_y,
                max: max_y,
              },
            },
            plugins: {
              legend: false,
              zoom: {
                pan: {
                  enabled: true,
                  mode: 'x',
                  modifierKey: 'ctrl',
                },
                zoom: {
                  drag: {
                    enabled: true,
                  },
                  mode: 'x',
                },
              },
            },
          },
        });

        document.getElementById(zoom_elt).addEventListener('click', () => chart.zoom(0.25));
      }

      make_chart('chart1', 'zoomout1');
      make_chart('chart2', 'zoomout2');
      make_chart('chart3', 'zoomout3');
      make_chart('chart4', 'zoomout4');
      make_chart('chart5', 'zoomout5');
      make_chart('chart6', 'zoomout6');
    </script>
  </body>
</html>
